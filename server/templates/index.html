<!DOCTYPE HTML>
<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Aquarium Control Configuration</title>
		<link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">
		<style type="text/css">
		body {
			margin: 5px
		}
		.global-saving-container {
			display: none;
			position: absolute;
			z-index: 1;
			left: 0;
			top: 0;
			right: 0;
			bottom: 0;
			background-color: rgba(0,0,0,0.5);
		}
		.global-saving {
			margin: 10%;
		}
		</style>
		<script>

		function setClass(id, className) {
			document.getElementById(id).className = className;
		}

		function setContent(id, text) {
			document.getElementById(id).innerHTML = text;
		}

		var changes = {},
			changesPresent = false;
		function updateState(category) {
			var p;
			function checkChangedState(lastSaveSettingsNode, currentSettingsNode) {
				var found = false;
				for (p in lastSaveSettingsNode) {
					if (typeof lastSaveSettings[p] === 'object') {
						found = found || checkChangedState(lastSaveSettingsNode[p], currentSettingsNode[p]);
					} else if (lastSaveSettingsNode[p] !== currentSettingsNode[p]) {
						found = true;
					}
				}
				return found;
			}
			function updateTabState(tab) {
				if (checkChangedState(lastSaveSettings[tab], currentSettings[tab])) {
					setContent(tab + 'Tab', tab[0].toUpperCase() + tab.substring(1) + '*');
					changes[tab] = true;
				} else {
					setContent(tab + 'Tab', tab[0].toUpperCase() + tab.substring(1));
					changes[tab] = false;
				}
			}
			if (category) {
				updateTabState(category);
			} else {
				updateTabState('mode');
				updateTabState('dynamic');
				updateTabState('static');
				updateTabState('manual');
			}
			changesPresent = false;
			for (p in changes) {
				changesPresent = changesPresent || changes[p];
			}
			setClass('global.save', changesPresent ? 'btn btn-primary' : 'btn btn-primary disabled');
		}

		var get = document.getElementById,
			lastSaveSettings = {
				mode: {
					mode: 'dynamic'
				},
				dynamic: {

				},
				static: {

				},
				manual: {
					setting: 'day'
				}
			},
			currentSettings = {
				mode: {
					mode: 'dynamic'
				},
				dynamic: {

				},
				static: {

				},
				manual: {
					setting: 'day'
				}
			},
			eventHandlers = {
				global: {
					save: function () {
						if (changesPresent) {
							var saving = document.getElementById('global.saving'),
								savingProgressBar = document.getElementById('global.savingProgressBar'),
								settings;
							saving.style.display = 'block';
							savingProgressBar.style.width = '0%';

							function updateLastSaveSettings(lastSaveSettingsNode, currentSettingsNode) {
								var p;
								for (p in lastSaveSettingsNode) {
									if (typeof lastSaveSettings[p] === 'object') {
										updateLastSaveSettings(lastSaveSettingsNode[p], currentSettingsNode[p]);
									} else {
										lastSaveSettingsNode[p] = currentSettingsNode[p]
									}
								}
								updateState();
							}
							updateLastSaveSettings(lastSaveSettings.mode, currentSettings.mode);
							updateLastSaveSettings(lastSaveSettings.dynamic, currentSettings.dynamic);
							updateLastSaveSettings(lastSaveSettings.static, currentSettings.static);
							updateLastSaveSettings(lastSaveSettings.manual, currentSettings.manual);
						}
					}
				},
				mode: {
					mode: {
						dynamic: function () {
							setClass('mode.mode.dynamic', 'active');
							setClass('mode.mode.static', '');
							setClass('mode.mode.manual', '');
							currentSettings.mode.mode = 'dynamic';
							updateState('mode');
						},
						static: function () {
							setClass('mode.mode.dynamic', '');
							setClass('mode.mode.static', 'active');
							setClass('mode.mode.manual', '');
							currentSettings.mode.mode = 'static';
							updateState('mode');
						},
						manual: function () {
							setClass('mode.mode.dynamic', '');
							setClass('mode.mode.static', '');
							setClass('mode.mode.manual', 'active');
							currentSettings.mode.mode = 'manual';
							updateState('mode');
						},
					}
				},
				dynamic: {

				},
				static: {

				},
				manual: {
					setting: {
						day: function () {
							setClass('manual.setting.day', 'active');
							setClass('manual.setting.night', '');
							setClass('manual.setting.off', '');
							currentSettings.manual.setting = 'day';
							updateState('manual');
						},
						night: function () {
							setClass('manual.setting.day', '');
							setClass('manual.setting.night', 'active');
							setClass('manual.setting.off', '');
							currentSettings.manual.setting = 'night';
							updateState('manual');
						},
						off: function () {
							setClass('manual.setting.day', '');
							setClass('manual.setting.night', '');
							setClass('manual.setting.off', 'active');
							currentSettings.manual.setting = 'off';
							updateState('manual');
						}
					}
				}
			}
		</script>
	</head>
	<body>
		<h2>Aquarium Control Configuration</h2>
		<div class="tabbable"> <!-- Only required for left/right tabs -->
			<ul class="nav nav-tabs">
				<li class="active"><a href="#tab0" data-toggle="tab" id="modeTab">Mode</a></li>
				<li><a href="#tab1" data-toggle="tab" id="dynamicTab">Dynamic</a></li>
				<li><a href="#tab2" data-toggle="tab" id="staticTab">Static</a></li>
				<li><a href="#tab3" data-toggle="tab" id="manualTab">Manual</a></li>
			</ul>
			<div class="tab-content">
				<div class="tab-pane active" id="tab0">
					<div class="controls">
						<ul class="nav nav-pills nav-stacked">
							<li id="mode.mode.dynamic" onclick="eventHandlers.mode.mode.dynamic();" class="active" ><a href="#">Dynamic</a></li>
							<li id="mode.mode.static" onclick="eventHandlers.mode.mode.static();"><a href="#">Static</a></li>
							<li id="mode.mode.manual" onclick="eventHandlers.mode.mode.manual();"><a href="#">Manual</a></li>
						</ul>
					</div>
				</div>
				<div class="tab-pane" id="tab1">
					<form id="form1">
						<legend>Sunrise Twilight Length</legend>
						<div class="control-group">
							<label class="control-label" for="inputDynamicSunriseTwilightLengthHours">Hours</label>
							<div class="controls">
								<input type="number" id="inputDynamicSunriseTwilightLengthHours" value="0" min="0" max="6" />
							</div>
						</div>
						<div class="control-group">
							<label class="control-label" for="inputDynamicSunriseTwilightLengthMinutes">Minutes</label>
							<div class="controls">
								<input type="number" id="inputDynamicSunriseTwilightLengthMinutes" value="0" min="-0" max="59" />
							</div>
						</div>
						<legend>Sunrise Offset</legend>
						<div class="control-group">
							<label class="control-label" for="inputDynamicSunriseOffsetHours">Hours</label>
							<div class="controls">
								<input type="number" id="inputDynamicSunriseOffsetHours" value="0" min="-6" max="6" />
							</div>
						</div>
						<div class="control-group">
							<label class="control-label" for="inputDynamicSunriseOffsetMinutes">Minutes</label>
							<div class="controls">
								<input type="number" id="inputDynamicSunriseOffsetMinutes" value="0" min="-59" max="59" />
							</div>
						</div>
						<legend>Sunset Offset</legend>
						<div class="control-group">
							<label class="control-label" for="inputDynamicSunsetOffsetHours">Hours</label>
							<div class="controls">
								<input type="number" id="inputDynamicSunsetOffsetHours" value="0" min="-6" max="6" />
							</div>
						</div>
						<div class="control-group">
							<label class="control-label" for="inputDynamicSunsetOffsetMinutes">Minutes</label>
							<div class="controls">
								<input type="number" id="inputDynamicSunsetOffsetMinutes" value="0" min="-59" max="59" />
							</div>
						</div>
						<legend>Sunset Twilight Length</legend>
						<div class="control-group">
							<label class="control-label" for="inputDynamicSunsetTwilightLengthHours">Hours</label>
							<div class="controls">
								<input type="number" id="inputDynamicSunsetTwilightLengthHours" value="0" min="0" max="6" />
							</div>
						</div>
						<div class="control-group">
							<label class="control-label" for="inputDynamicSunsetTwilightLengthMinutes">Minutes</label>
							<div class="controls">
								<input type="number" id="inputDynamicSunsetTwilightLengthMinutes" value="0" min="-0" max="59" />
							</div>
						</div>
					</form>
				</div>
				<div class="tab-pane" id="tab2">
					<form id="form2">
						<legend>Sunrise Twilight</legend>
						<div class="control-group">
							<label class="control-label" for="inputManualSunriseTwilightHours">Hours</label>
							<div class="controls">
								<input type="number" id="inputManualSunriseTwilightHours" value="0" min="0" max="6" />
							</div>
						</div>
						<div class="control-group">
							<label class="control-label" for="inputManualSunriseTwilightMinutes">Minutes</label>
							<div class="controls">
								<input type="number" id="inputManualSunriseTwilightMinutes" value="0" min="-0" max="59" />
							</div>
						</div>
						<legend>Sunrise</legend>
						<div class="control-group">
							<label class="control-label" for="inputManualSunriseHours">Hours</label>
							<div class="controls">
								<input type="number" id="inputManualSunriseHours" value="0" min="-6" max="6" />
							</div>
						</div>
						<div class="control-group">
							<label class="control-label" for="inputManualSunriseMinutes">Minutes</label>
							<div class="controls">
								<input type="number" id="inputManualSunriseMinutes" value="0" min="-59" max="59" />
							</div>
						</div>
						<legend>Sunset</legend>
						<div class="control-group">
							<label class="control-label" for="inputManualSunsetHours">Hours</label>
							<div class="controls">
								<input type="number" id="inputManualSunsetHours" value="0" min="-6" max="6" />
							</div>
						</div>
						<div class="control-group">
							<label class="control-label" for="inputManualSunsetMinutes">Minutes</label>
							<div class="controls">
								<input type="number" id="inputManualSunsetMinutes" value="0" min="-59" max="59" />
							</div>
						</div>
						<legend>Sunset Twilight</legend>
						<div class="control-group">
							<label class="control-label" for="inputManualSunsetTwilightHours">Hours</label>
							<div class="controls">
								<input type="number" id="inputManualSunsetTwilightHours" value="0" min="0" max="6" />
							</div>
						</div>
						<div class="control-group">
							<label class="control-label" for="inputManualSunsetTwilightMinutes">Minutes</label>
							<div class="controls">
								<input type="number" id="inputManualSunsetTwilightMinutes" value="0" min="-0" max="59" />
							</div>
						</div>
					</form>
				</div>
				<div class="tab-pane" id="tab3">
					<form id="form3">
						<div class="control-group">
							<label class="control-label" for="inputMode">Setting</label>
							<div class="controls">
								<ul class="nav nav-pills nav-stacked">
									<li id="manual.setting.day" onclick="eventHandlers.manual.setting.day();" class="active"><a href="#">Day</a></li>
									<li id="manual.setting.night" onclick="eventHandlers.manual.setting.night();"><a href="#">Night</a></li>
									<li id="manual.setting.off" onclick="eventHandlers.manual.setting.off();"><a href="#">Off</a></li>
								</ul>
							</div>
						</div>
					</form>
				</div>
			</div>
		</div>
		<div>
			<form id="form0">
				<div class="control-group">
					<div class="controls">
						<a id="global.save" class="btn btn-primary disabled" href="#" onclick="eventHandlers.global.save();">Apply Settings</a>
					</div>
				</div>
			</form>
		</div>
		<div id="global.saving" class="global-saving-container">
			<div class="global-saving">
				<div class="hero-unit">
					<h2>Saving</h2>
					<div class="progress">
						<div id="global.savingProgressBar" class="bar" style="width: 100%;"></div>
					</div>
				</div>
			</div>
		</div>
		<script>
		var formClass = window.innerWidth < 400 ? "form" : "form-horizontal";
		setClass('form0', formClass);
		setClass('form1', formClass);
		setClass('form2', formClass);
		setClass('form3', formClass);
		</script>
		<script src="jquery-1.7.1.js"></script>
		<script src="bootstrap/js/bootstrap.min.js"></script>
	</body>
</html>